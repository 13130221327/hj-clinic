# 何江牙所患者记录系统

一个基于 Python 标准库的轻量 Web 应用，用于管理牙科门诊患者就诊信息、费用明细和经营统计。系统无需安装数据库和第三方依赖，适合在诊所前台电脑或小主机上直接运行。

## 核心功能

### 1) 患者登记与病历信息
- 新增患者记录：姓名、性别、年龄、电话、病历号、就诊日期
- 支持“是否复诊”标记，用于统计复诊率
- 记录主诉、诊断、备注等完整就诊信息
- 输入已存在患者姓名时可自动回填基础信息（性别/年龄/电话/病历号）
- 支持一键生成病历号，并可手动编辑

### 2) 费用项目化录入
- 支持多费用项目录入（如挂号、检查、洗牙、补牙等）
- 每个项目可设置：项目名称、单价、数量，系统自动计算小计与总计
- 自动记忆历史项目价格：再次选择同名项目时可带出参考单价
- 同时兼容旧数据中的单一“总费用”字段

### 3) 患者记录管理
- 记录列表展示，按日期倒序查看
- 快速筛选：按日 / 周 / 月 / 全部
- 按患者姓名筛选（查看该患者全部历史）
- 一键删除记录
- 支持导出当前筛选结果为 CSV（Excel 可直接打开）

### 4) 统计与分析
- 基础经营指标：
  - 总就诊人次、今日人次
  - 今日费用、本月费用、累计费用
- 分析指标：
  - 累计收入、平均客单价、复诊率
  - 患者性别分布（男/女/未知）
  - 就诊次数 Top 5 患者
- 首页展示“今日就诊卡片”，快速查看当天接诊情况

## 技术方案

- 后端：Python 标准库 `http.server`（`ThreadingHTTPServer`）
- 数据存储：本地 JSON 文件 `data/records.json`
- 数据导出：标准库 `csv` 生成 UTF-8 BOM CSV
- 前端：服务端渲染 HTML + 原生 JavaScript（无前端构建流程）

## 运行环境

- Python 3.10+（建议）
- Linux / macOS / Windows 均可运行

## 快速启动

```bash
python app.py
```

启动后访问：<http://localhost:8000>

## 数据文件说明

- 默认数据路径：`data/records.json`
- 首次启动会自动创建数据目录和空数据文件
- 备份时仅需备份该 JSON 文件

## 常见部署方式

### 方式 1：前台电脑直接运行

```bash
python app.py
```

适合小规模诊所内网使用，部署最简单。

### 方式 2：Linux `systemd` 后台托管

将 `python /path/to/app.py` 配置成服务，实现：
- 开机自启
- 异常自动重启
- 统一日志管理

## 注意事项

- 本项目为本地文件存储，建议定期备份 `data/records.json`
- 若用于生产环境公网访问，建议配合反向代理与访问控制（如 Nginx + 内网/VPN）
